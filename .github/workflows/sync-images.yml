name: Sync Feishu Images

on:
  workflow_dispatch:  # 手动触发按钮
  # schedule:         # 定时触发 (可选，暂时注释)
  #   - cron: '0 * * * *'  # 每小时执行一次

jobs:
  sync:
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: ./app

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: app/package-lock.json

    - name: Install dependencies
      run: npm install

    - name: Run Sync Script
      env:
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        APP_TOKEN: ${{ secrets.APP_TOKEN }}
        TABLE_ID: ${{ secrets.TABLE_ID }}
        R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
        R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
        R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        R2_BUCKET_NAME: ${{ secrets.R2_BUCKET_NAME }}
        R2_PUBLIC_DOMAIN: ${{ secrets.R2_PUBLIC_DOMAIN }}
      run: node sync-images.js
